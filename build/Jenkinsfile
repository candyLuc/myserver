pipline{
    agent any
    environment {
        REGISTRY = '192.168.43.159:30002'
    }
    stages {
        stage('docker login') {
            steps {
                echo "=======================docker login======================="
                sh """
                    docker login -u admin -p Harbor12345 http://$REGISTRY
                """
            }
        }
        stage('docker build') {
            steps {
                echo "=======================docker build======================="
                sh """
                    docker build -f build/Dockerfile -t $REGISTRY/shop/myserver:\${version}.\${branch}
                """
            }
        }
        stage('docker push') {
            steps {
                echo "=======================docker push======================="
                sh """
                    docker push $REGISTRY/shop/myserver:\${version}.\${branch}
                """
            }
        }
    }
}